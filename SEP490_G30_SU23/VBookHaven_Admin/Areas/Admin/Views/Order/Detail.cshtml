@using VBookHaven.Models
@using VBookHaven_Admin.Areas.Admin.Controllers
@using System.Text.Json
@using VBookHaven_Admin

@model EditOrderManagementModel

@{
    int numStatus = OrderStatus.ToNum(Model.Order.Status);
    double total = 0;
    foreach (OrderDetail o in Model.Order.OrderDetails)
    {
        total += o.UnitPrice.Value * (1 - o.Discount.Value / 100) * o.Quantity.Value;
    }
}

<style>
    #searchList {
        position: absolute;
        z-index: 3;
        display: none;
        box-shadow: 2px 2px gray;
    }

    .item {
        padding: 10px 15px;
    }

    #list-product {
        border: 1px solid lightgray;
        overflow-y: auto;
        max-height: 350px;
    }

    .cover {
        padding: 0;
        width: 60px;
        height: 50px;
    }

    img {
        width: 100%;
        height: 100%;
    }

    td:nth-child(3) {
        max-width: 100px;
    }

    /* Custom CSS for truncating text and keeping the link next to it */

    .ellipsis {
        display: -webkit-box;
        -webkit-box-orient: vertical;
        -webkit-line-clamp: 3;
        /* Set the number of lines to display */
        overflow: hidden;
    }

    /* Custom CSS for adjusting the size of the ellipsis div */

    .ellipsis-div {
        max-width: 150px;
        /* Set the maximum width for the div (adjust as needed) */
    }

    input[type=number] {
        width: 100%;
        text-align: center;
    }

    /* Custom CSS for text overflow ellipsis */
</style>

<!--page-wrapper-->
<div class="page-wrapper">
    <!--page-content-wrapper-->
    <div class="page-content-wrapper">
        <div class="page-content">
            <!--breadcrumb-->
            <div class="page-breadcrumb d-none d-sm-flex align-items-center mb-3">
                <div class="breadcrumb-title pe-3">Đơn hàng</div>
                <div class="ps-3">
                    <nav aria-label="breadcrumb">
                        <ol class="breadcrumb mb-0 p-0">
                            <li class="breadcrumb-item">
                                <a href="/Admin/Order/Index">
                                    <i class="bx bx-home-alt"></i>
                                </a>
                            </li>
                            <li class="breadcrumb-item active" aria-current="page">Tạo đơn hàng</li>
                        </ol>
                    </nav>
                </div>
            </div>
            <!--end breadcrumb-->
            <div class="row">
                <div class="col-9 mx-auto">
                    <div class="card">
                        <div class="card-body d-flex justify-content-center align-items-center wizard-container">
                            <!-- Status progress bar -->
                            <div class="wizard-progress w-100">
                                @if (Model.Order.Status.Equals(OrderStatus.Cancel))
                                {
                                    <div class="step complete">
                                        <span class="title">@OrderStatus.Create</span>
                                        <div class="node"></div>
                                    </div>
                                    <div class="step">
                                        <span class="title">@OrderStatus.Process</span>
                                        <div class="node"></div>
                                    </div>
                                    <div class="step">
                                        <span class="title">@OrderStatus.Payment</span>
                                        <div class="node"></div>
                                    </div>
                                    <div class="step">
                                        <span class="title">@OrderStatus.Packaging</span>
                                        <div class="node"></div>
                                    </div>
                                    <div class="step">
                                        <span class="title">@OrderStatus.Ship</span>
                                        <div class="node"></div>
                                    </div>
                                    <div class="step">
                                        <span class="title">@OrderStatus.Done</span>
                                        <div class="node"></div>
                                    </div>
                                    <div class="step complete">
                                        <span class="title">@OrderStatus.Cancel</span>
                                        <div class="node"></div>
                                    </div>
                                }
                                else
                                {
                                    <div class="step complete">
                                        <span class="title">@OrderStatus.Create</span>
                                        <div class="node"></div>
                                    </div>
                                    <div class="step @(numStatus >= 1 ? "complete" : "")">
                                        <span class="title">@OrderStatus.Process</span>
                                        <div class="node"></div>
                                    </div>
                                    <div class="step @(numStatus >= 2 ? "complete" : "")">
                                        <span class="title">@OrderStatus.Payment</span>
                                        <div class="node"></div>
                                    </div>
                                    <div class="step @(numStatus >= 3 ? "complete" : "")">
                                        <span class="title">@OrderStatus.Packaging</span>
                                        <div class="node"></div>
                                    </div>
                                    <div class="step @(numStatus >= 4 ? "complete" : "")">
                                        <span class="title">@OrderStatus.Ship</span>
                                        <div class="node"></div>
                                    </div>
                                    <div class="step @(numStatus >= 5 ? "complete" : "")">
                                        <span class="title">@OrderStatus.Done</span>
                                        <div class="node"></div>
                                    </div>
                                    <div class="step">
                                        <span class="title">@OrderStatus.Cancel</span>
                                        <div class="node"></div>
                                    </div>
                                }
                            </div>
                        </div>
                    </div>
                    <div class="col-12 card border-top border-0 border-4 border-primary">
                        <div class="pt-4 px-5">
                            <div class="card-title d-flex align-items-center">
                                <div>
                                    <i class="bx bxs-user-rectangle bx-tada me-2 fs-4"></i>
                                </div>
                                <h4 class="mb-0 fw-bold">Khách hàng</h4>
                            </div>
                            <hr>
                            <div class="card-body row g-3">
                                <!-- không fix code >> chú ý id div này >> id liên quan đến js -->
                                <div id="customerInfoContainer" class="mb-4">
                                    <div class="customer-info">
                                        <h6 class="text-primary fw-bold">@Model.Order.CustomerName</h6>
                                        <label class="fw-bold">Số điện thoại: @Model.Order.Phone</label><br />
                                        <label class="fw-bold">Địa chỉ: @Model.Order.ShipAddress</label>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-3 mx-auto card border-top border-0 border-4 border-primary">
                    <div class="card-title text-center pt-4">
                        <h4 class="mb-0 fw-bold">Thông tin bổ sung</h4>
                    </div>
                    <div class="card-body">
                        <label class="form-label">Ghi chú hóa đơn</label><br>
                        <textarea class="form-control" cols="30" rows="6" readonly>@Model.Order.Note</textarea>
                    </div>
                </div>
                <div class="col-12 mx-auto pe-0">
                    <div class="card border-top border-0 border-4 border-primary">
                        <div class="card-body p-5">
                            <div class="card-title d-flex align-items-center">
                                <div>
                                    <i class="bx bxs-receipt bx-tada me-2 fs-4"></i>
                                </div>
                                <h4 class="mb-0 fw-bold">Chi tiết đơn hàng</h4>
                            </div>
                            <hr>
                            <div class="row g-3">
                                <div class="col-md-12">
                                    <table id="myTable"
                                            class="table table-striped table-bordered text-center">
                                        <thead>
                                            <tr>
                                                <th>STT</th>
                                                <th class="col-1">Ảnh</th>
                                                <th class="col-2">Tên SP</th>
                                                <th class="col-1">Đơn vị</th>
                                                <th class="col-1">Số lượng</th>
                                                <th class="col-2">Đơn giá</th>
                                                <th class="col-2">Chiết khấu</th>
                                                <th class="col-2">Thành tiền</th>
                                            </tr>
                                        </thead>
                                        <!-- không fix code >> chú ý id div này >> id liên quan đến js -->
                                        <tbody id="orderContainer">
                                            @for (int i = 0; i < Model.Details.Count; ++i)
                                            {
                                                OrderDetail o = Model.Details[i];

                                                <tr>
                                                    <td></td>
                                                    <td><img src="~/images/img/@Model.Thumbnails[i]" style="aspect-ratio: 1/1"></td>
                                                    <td>
                                                        <div class="ellipsis">
                                                            @o.Product.Name
                                                        </div>
                                                    </td>
                                                    <td>@o.Product.Unit</td>
                                                    <td>@o.Quantity</td>
                                                    <td>@o.UnitPrice VNĐ</td>
                                                    <td>@o.Discount%</td>
                                                    <td>@(o.UnitPrice.Value * (1 - o.Discount.Value / 100) * o.Quantity.Value) VNĐ</td>
                                                </tr>
                                            }
                                        </tbody>
                                    </table>
                                </div>
                                <div class="col-7 d-flex justify-content-start align-items-end">
                                    <button type="button" class="btn btn-secondary px-4 mx-1"
                                            onclick="window.location.href='/Admin/Order/Index'">
                                        Quay lại
                                    </button>
                                </div>
                                <div class="col-5">
                                    <table class="table" id="countTable">
                                        <tr>
                                            <td>Cộng tiền hàng</td>
                                            <td class="text-end">@total VNĐ</td>
                                        </tr>
                                        <tr>
                                            <td>Thuế GTGT</td>
                                            <td class="text-end">@Model.Order.VAT%</td>
                                        </tr>
                                        <tr>
                                            <th><strong>Tổng tiền thanh toán</strong></th>
                                            <td class="text-end">
                                                <strong>
                                                    <span id="totalPay">@(total * (1 + Model.Order.VAT / 100))</span>
                                                    VNĐ
                                                </strong>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td>Số tiền khách đã trả</td>
                                            <td class="text-end">@Model.Order.AmountPaid VNĐ</td>
                                        </tr>
                                        <tr>
                                            <td>Số tiền còn thiếu</td>
                                            <td class="text-end">@(total * (1 + Model.Order.VAT / 100) - Model.Order.AmountPaid) VNĐ</td>
                                        </tr>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!--end page-content-wrapper-->
</div>
<!--end page-wrapper-->